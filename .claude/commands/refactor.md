# 重构流程

## 输入
$ARGUMENTS

## 步骤
1. 阅读目标代码，理解现有逻辑和依赖关系
2. 制定重构计划，明确：
   - 重构目标（可读性/性能/解耦/拆分）
   - 影响范围（哪些文件、哪些调用方）
   - 风险点（可能破坏的功能）
3. 如果影响范围 > 3个文件，先询问用户确认方案
4. 逐步重构，每步保持可运行状态：
   - 先写测试覆盖现有行为（如果没有）
   - 重构代码
   - 运行测试确认行为不变
5. 检查拆分后单文件是否 ≤ 500行
6. 运行全量测试：
   ```bash
   ./agent/venv2/bin/python -m pytest tests/ -v
   ```
7. 更新 docs/CONTEXT.md
8. 提交代码

## 重构原则
- 行为不变：重构前后功能完全一致
- 小步前进：每次只改一件事
- 测试保障：无测试不重构
- 不顺手加功能：重构和功能开发分开提交
